plugins {
  id "com.jetbrains.python.envs" version "0.0.25"
}

repositories {
    mavenLocal()
    mavenCentral()
}

dependencies {
}

task build_xar {

}

// Set up python environments for pre-commit
envs {
    bootstrapDirectory = file('.')
    python "virtualenv_run", "3.6.7", ["pre-commit", "requirements-tools", "tox"]
}

task install_hooks {
    dependsOn "build_envs"

    doLast {
        exec {
            executable file("./virtualenv_run/bin/pre-commit")
            args "install", "-f", "--install-hooks"
        }
    }
}

task install_xar_tools {
    dependsOn "build_envs"

    doLast {
        exec {
            commandLine "git"
            args "clone", "https://github.com/facebookincubator/xar.git"
        }
        exec {
            executable file("./virtualenv_run/bin/pip")
            args "install", "xar/"
        }
        exec {
            commandLine "rm"
            args "-rf", "xar/"
        }
    }
}
