plugins {
  id "jaci.gradle.EmbeddedTools" version "2018.09.21"
}

ext {
}

repositories {
  mavenCentral()
}

dependencies {
}

deploy {
    targets {
        target("test") {
            directory = "/home/lvuser"
            maxChannels = 1
            timeout = 3
            failOnMissing = true

            locations {
                ssh {
                    address = "roborio-5499-frc.local"
                    user = "admin"
                    password = ""
                    ipv6 = false
                }
                ssh {
                    address = "10.54.99.2"
                    user = "admin"
                    password = ""
                    ipv6 = false
                }
            }
        }
    }
    artifacts {
        // COMMON PROPERTIES FOR ALL ARTIFACTS //
        all {
            directory = 'dashboard/'
            targets << 'test'

            onlyIf = { execute('echo hi').result == 'hi\n' }

            predeploy << { execute 'echo Pre' }      // After onlyIf, but before deploy logic
            postdeploy << { execute 'echo Post' }    // After this artifact's deploy logic

            disabled = false

            // dependsOn('_______')
        }
        // END COMMON //

        fileCollectionArtifact('files') {
            files = fileTree(dir: 'dashboard/')
        }
    }
}

// Set up python environments for pre-commit
envs {
    bootstrapDirectory = file('.')
    python "virtualenv_run", "3.6.7", ["pre-commit", "requirements-tools", "tox"]
}

task install_hooks {
    dependsOn: "build_envs"

    doLast {
        exec {
            executable file("./virtualenv_run/bin/pre-commit")
            args "install", "-f", "--install-hooks"
        }
    }
}
